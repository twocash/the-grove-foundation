<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>S7-SL-AutoAdvancement - Sprint Review</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      color: #e4e4e4;
      min-height: 100vh;
      padding: 40px;
    }
    .container { max-width: 1200px; margin: 0 auto; }

    header {
      text-align: center;
      margin-bottom: 48px;
      padding: 32px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    h1 {
      font-size: 2.5rem;
      background: linear-gradient(135deg, #00d9ff 0%, #00ff88 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 8px;
    }
    .sprint-meta {
      color: #888;
      font-size: 0.9rem;
    }

    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 48px;
    }
    .metric-card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 24px;
      text-align: center;
    }
    .metric-value {
      font-size: 2.5rem;
      font-weight: bold;
      color: #00d9ff;
    }
    .metric-value.success { color: #00ff88; }
    .metric-value.warning { color: #ffaa00; }
    .metric-label {
      font-size: 0.85rem;
      color: #888;
      margin-top: 8px;
    }

    section {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 16px;
      padding: 32px;
      margin-bottom: 32px;
    }
    h2 {
      font-size: 1.5rem;
      color: #00d9ff;
      margin-bottom: 24px;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    h3 {
      font-size: 1.1rem;
      color: #00ff88;
      margin: 24px 0 12px;
    }

    .phase-list {
      list-style: none;
    }
    .phase-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    .phase-item:last-child { border-bottom: none; }
    .phase-status {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
    }
    .phase-status.complete { background: rgba(0, 255, 136, 0.2); }
    .phase-status.skipped { background: rgba(255, 170, 0, 0.2); }
    .phase-name { flex: 1; }
    .phase-description { color: #888; font-size: 0.85rem; }

    .file-list {
      display: grid;
      gap: 8px;
    }
    .file-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-family: 'Fira Code', 'Consolas', monospace;
      font-size: 0.85rem;
      padding: 8px 12px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 6px;
    }
    .file-badge {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 4px;
      font-weight: 600;
    }
    .file-badge.new { background: rgba(0, 255, 136, 0.2); color: #00ff88; }
    .file-badge.modified { background: rgba(255, 170, 0, 0.2); color: #ffaa00; }

    .media-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 24px;
    }
    .media-item {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 12px;
      overflow: hidden;
    }
    .media-item img {
      width: 100%;
      display: block;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .media-caption {
      padding: 12px 16px;
      font-size: 0.85rem;
      color: #888;
    }

    .feature-list {
      list-style: none;
    }
    .feature-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 12px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    .feature-item:last-child { border-bottom: none; }
    .feature-icon {
      font-size: 1.2rem;
      padding-top: 2px;
    }
    .feature-content strong {
      color: #e4e4e4;
      display: block;
      margin-bottom: 4px;
    }
    .feature-content span {
      color: #888;
      font-size: 0.9rem;
    }

    .dex-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
    }
    .dex-card {
      background: rgba(0, 217, 255, 0.05);
      border: 1px solid rgba(0, 217, 255, 0.2);
      border-radius: 12px;
      padding: 20px;
    }
    .dex-card h4 {
      color: #00d9ff;
      margin-bottom: 8px;
      font-size: 0.95rem;
    }
    .dex-card p {
      color: #888;
      font-size: 0.85rem;
      line-height: 1.5;
    }

    footer {
      text-align: center;
      padding: 32px;
      color: #555;
      font-size: 0.85rem;
    }
    footer a {
      color: #00d9ff;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>S7-SL-AutoAdvancement</h1>
      <p class="sprint-meta">Programmable Curation Engine | Grove Execution Protocol v1.5 | 2026-01-16</p>
    </header>

    <!-- Summary Metrics -->
    <div class="metrics-grid">
      <div class="metric-card">
        <div class="metric-value success">6/6</div>
        <div class="metric-label">Phases Complete</div>
      </div>
      <div class="metric-card">
        <div class="metric-value success">2/2</div>
        <div class="metric-label">E2E Tests Passing</div>
      </div>
      <div class="metric-card">
        <div class="metric-value">3</div>
        <div class="metric-label">Screenshots Captured</div>
      </div>
      <div class="metric-card">
        <div class="metric-value success">0</div>
        <div class="metric-label">Critical Console Errors</div>
      </div>
    </div>

    <!-- Phase Progress -->
    <section>
      <h2>Phase Progress</h2>
      <ul class="phase-list">
        <li class="phase-item">
          <span class="phase-status complete">‚úì</span>
          <div>
            <div class="phase-name">Phase 1: Infrastructure</div>
            <div class="phase-description">Database migrations (018, 019), type registry, Experience Console registry, data hook</div>
          </div>
        </li>
        <li class="phase-item">
          <span class="phase-status complete">‚úì</span>
          <div>
            <div class="phase-name">Phase 2: UI Components</div>
            <div class="phase-description">AdvancementRuleCard, AdvancementRuleEditor with criteria builder, component registry</div>
          </div>
        </li>
        <li class="phase-item">
          <span class="phase-status complete">‚úì</span>
          <div>
            <div class="phase-name">Phase 3: Evaluation Engine</div>
            <div class="phase-description">Pure TypeScript evaluator, signal fetcher from S6, batch job orchestrator</div>
          </div>
        </li>
        <li class="phase-item">
          <span class="phase-status complete">‚úì</span>
          <div>
            <div class="phase-name">Phase 4: Operator Controls</div>
            <div class="phase-description">AdvancementHistoryPanel, ManualOverrideModal, BulkRollbackModal</div>
          </div>
        </li>
        <li class="phase-item">
          <span class="phase-status complete">‚úì</span>
          <div>
            <div class="phase-name">Phase 5: Gardener Experience</div>
            <div class="phase-description">TierBadge enhancement with advancement metadata, rich tooltip, sparkle indicator</div>
          </div>
        </li>
        <li class="phase-item">
          <span class="phase-status complete">‚úì</span>
          <div>
            <div class="phase-name">Phase 6: E2E Testing & Review</div>
            <div class="phase-description">E2E test with console monitoring, REVIEW.html, DEVLOG completion</div>
          </div>
        </li>
      </ul>
    </section>

    <!-- Screenshots -->
    <section>
      <h2>Visual Evidence</h2>
      <div class="media-grid">
        <div class="media-item">
          <img src="screenshots/02a-experience-console.png" alt="Experience Console with advancement-rule type">
          <div class="media-caption">Phase 2: Experience Console with advancement-rule type registered</div>
        </div>
        <div class="media-item">
          <img src="screenshots/e2e/05-experience-console.png" alt="E2E: Experience Console loads">
          <div class="media-caption">E2E US-A005: Experience Console loads without errors</div>
        </div>
        <div class="media-item">
          <img src="screenshots/e2e/06-bedrock-dashboard.png" alt="E2E: Bedrock Dashboard">
          <div class="media-caption">E2E US-A006: Bedrock route loads without type registry errors</div>
        </div>
      </div>
    </section>

    <!-- Key Files Changed -->
    <section>
      <h2>Files Changed</h2>

      <h3>Database Migrations (New)</h3>
      <div class="file-list">
        <div class="file-item">
          <span class="file-badge new">NEW</span>
          <span>supabase/migrations/018_advancement_rules.sql</span>
        </div>
        <div class="file-item">
          <span class="file-badge new">NEW</span>
          <span>supabase/migrations/019_advancement_events.sql</span>
        </div>
      </div>

      <h3>Core Schema & Engine (New)</h3>
      <div class="file-list">
        <div class="file-item">
          <span class="file-badge new">NEW</span>
          <span>src/core/schema/advancement.ts</span>
        </div>
        <div class="file-item">
          <span class="file-badge new">NEW</span>
          <span>src/core/engine/advancementEvaluator.ts</span>
        </div>
        <div class="file-item">
          <span class="file-badge new">NEW</span>
          <span>src/core/engine/signalFetcher.ts</span>
        </div>
        <div class="file-item">
          <span class="file-badge new">NEW</span>
          <span>src/core/jobs/advancementBatchJob.ts</span>
        </div>
      </div>

      <h3>Experience Console Components (New)</h3>
      <div class="file-list">
        <div class="file-item">
          <span class="file-badge new">NEW</span>
          <span>src/bedrock/consoles/ExperienceConsole/AdvancementRuleCard.tsx</span>
        </div>
        <div class="file-item">
          <span class="file-badge new">NEW</span>
          <span>src/bedrock/consoles/ExperienceConsole/AdvancementRuleEditor.tsx</span>
        </div>
        <div class="file-item">
          <span class="file-badge new">NEW</span>
          <span>src/bedrock/consoles/ExperienceConsole/useAdvancementRuleData.ts</span>
        </div>
      </div>

      <h3>Operator Controls (New)</h3>
      <div class="file-list">
        <div class="file-item">
          <span class="file-badge new">NEW</span>
          <span>src/bedrock/consoles/ExperienceConsole/AdvancementHistoryPanel.tsx</span>
        </div>
        <div class="file-item">
          <span class="file-badge new">NEW</span>
          <span>src/bedrock/consoles/ExperienceConsole/ManualOverrideModal.tsx</span>
        </div>
        <div class="file-item">
          <span class="file-badge new">NEW</span>
          <span>src/bedrock/consoles/ExperienceConsole/BulkRollbackModal.tsx</span>
        </div>
      </div>

      <h3>Modified Files</h3>
      <div class="file-list">
        <div class="file-item">
          <span class="file-badge modified">MOD</span>
          <span>src/core/schema/grove-object.ts</span>
        </div>
        <div class="file-item">
          <span class="file-badge modified">MOD</span>
          <span>src/bedrock/types/experience.types.ts</span>
        </div>
        <div class="file-item">
          <span class="file-badge modified">MOD</span>
          <span>src/bedrock/consoles/ExperienceConsole/component-registry.ts</span>
        </div>
        <div class="file-item">
          <span class="file-badge modified">MOD</span>
          <span>src/bedrock/consoles/ExperienceConsole/hook-registry.ts</span>
        </div>
        <div class="file-item">
          <span class="file-badge modified">MOD</span>
          <span>src/surface/components/TierBadge/TierBadge.tsx</span>
        </div>
        <div class="file-item">
          <span class="file-badge modified">MOD</span>
          <span>src/surface/components/TierBadge/TierBadge.types.ts</span>
        </div>
      </div>
    </section>

    <!-- Key Features -->
    <section>
      <h2>Key Features Delivered</h2>
      <ul class="feature-list">
        <li class="feature-item">
          <span class="feature-icon">üìã</span>
          <div class="feature-content">
            <strong>Declarative Advancement Rules</strong>
            <span>JSON-based rule configuration with criteria (signal, operator, threshold) and AND/OR logic</span>
          </div>
        </li>
        <li class="feature-item">
          <span class="feature-icon">üìä</span>
          <div class="feature-content">
            <strong>Signal Integration from S6</strong>
            <span>Reads retrievals, citations, queryDiversity, utilityScore from sprout_signal_aggregations</span>
          </div>
        </li>
        <li class="feature-item">
          <span class="feature-icon">‚öôÔ∏è</span>
          <div class="feature-content">
            <strong>Pure TypeScript Evaluation Engine</strong>
            <span>Model-agnostic evaluator with first-match-wins strategy and full criteria breakdown</span>
          </div>
        </li>
        <li class="feature-item">
          <span class="feature-icon">üîÑ</span>
          <div class="feature-content">
            <strong>Batch Job Orchestrator</strong>
            <span>Daily batch processing with dry-run mode, tier filtering, and configurable batch sizes</span>
          </div>
        </li>
        <li class="feature-item">
          <span class="feature-icon">üìú</span>
          <div class="feature-content">
            <strong>Full Audit Trail</strong>
            <span>All advancements logged with signal snapshots, criteria evaluation, and rollback support</span>
          </div>
        </li>
        <li class="feature-item">
          <span class="feature-icon">üéõÔ∏è</span>
          <div class="feature-content">
            <strong>Operator Controls</strong>
            <span>Manual override modal, bulk rollback with time filters, advancement history panel</span>
          </div>
        </li>
        <li class="feature-item">
          <span class="feature-icon">‚ú®</span>
          <div class="feature-content">
            <strong>TierBadge Enhancement</strong>
            <span>Rich tooltip with advancement provenance, sparkle indicator for recent advancements (24h)</span>
          </div>
        </li>
      </ul>
    </section>

    <!-- DEX Compliance -->
    <section>
      <h2>DEX Compliance</h2>
      <div class="dex-grid">
        <div class="dex-card">
          <h4>Declarative Sovereignty</h4>
          <p>All advancement rules are JSON config in JSONB payload. No hardcoded domain logic. Operators change behavior via UI, not code.</p>
        </div>
        <div class="dex-card">
          <h4>Capability Agnosticism</h4>
          <p>Pure TypeScript evaluation engine with no model dependencies. Rule evaluation works with any signal source.</p>
        </div>
        <div class="dex-card">
          <h4>Provenance as Infrastructure</h4>
          <p>Full audit trail with signal snapshots at evaluation time. Every advancement tracks fromTier, toTier, rule ID, and timestamp.</p>
        </div>
        <div class="dex-card">
          <h4>Organic Scalability</h4>
          <p>Registry pattern for Experience Console. Factory-based components. Batch processing handles any number of sprouts.</p>
        </div>
      </div>
    </section>

    <!-- E2E Test Results -->
    <section>
      <h2>E2E Test Results</h2>
      <p style="margin-bottom: 16px;">Test file: <code>tests/e2e/auto-advancement.spec.ts</code></p>
      <ul class="phase-list">
        <li class="phase-item">
          <span class="phase-status complete">‚úì</span>
          <div>
            <div class="phase-name">US-A005: Experience Console loads without errors</div>
            <div class="phase-description">Zero critical console errors, type registry integration verified</div>
          </div>
        </li>
        <li class="phase-item">
          <span class="phase-status complete">‚úì</span>
          <div>
            <div class="phase-name">US-A006: Bedrock route loads without type registry errors</div>
            <div class="phase-description">advancement-rule type registered correctly, no TypeError/ReferenceError</div>
          </div>
        </li>
        <li class="phase-item">
          <span class="phase-status skipped">-</span>
          <div>
            <div class="phase-name">US-A001-A004: TierBadge Advancement Indicator</div>
            <div class="phase-description">Skipped - requires SproutFinishingRoom integration (outside S7 scope)</div>
          </div>
        </li>
      </ul>
    </section>

    <footer>
      <p>Sprint Review generated by Grove Execution Protocol v1.5</p>
      <p>Sprint documentation: <a href="DEVLOG.md">DEVLOG.md</a> | <a href="SPEC.md">SPEC.md</a></p>
    </footer>
  </div>
</body>
</html>
