<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>S26-NUR Sprint Review</title>
  <style>
    :root {
      --bg: #0f172a;
      --surface: #1e293b;
      --surface-2: #334155;
      --text: #f1f5f9;
      --text-muted: #94a3b8;
      --accent: #06b6d4;
      --success: #10b981;
      --warning: #f59e0b;
      --error: #ef4444;
      --violet: #8b5cf6;
      --border: #334155;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      padding: 2rem;
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 { font-size: 2rem; margin-bottom: 0.5rem; }
    h2 { font-size: 1.5rem; margin: 2rem 0 1rem; color: var(--accent); border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; }
    h3 { font-size: 1.1rem; margin: 1.5rem 0 0.5rem; }
    .header { margin-bottom: 2rem; }
    .header .subtitle { color: var(--text-muted); font-size: 1rem; }
    .metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
      margin: 1.5rem 0;
    }
    .metric {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1rem;
      text-align: center;
    }
    .metric .value { font-size: 2rem; font-weight: 700; }
    .metric .label { color: var(--text-muted); font-size: 0.85rem; }
    .metric.success .value { color: var(--success); }
    .metric.accent .value { color: var(--accent); }
    .metric.violet .value { color: var(--violet); }
    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    .badge-success { background: rgba(16,185,129,0.15); color: var(--success); }
    .badge-accent { background: rgba(6,182,212,0.15); color: var(--accent); }
    .badge-warning { background: rgba(245,158,11,0.15); color: var(--warning); }
    table { width: 100%; border-collapse: collapse; margin: 1rem 0; }
    th, td { padding: 0.5rem 0.75rem; text-align: left; border-bottom: 1px solid var(--border); }
    th { color: var(--text-muted); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.05em; }
    td { font-size: 0.9rem; }
    .file-new { color: var(--success); }
    .file-mod { color: var(--warning); }
    .screenshot-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 1.5rem;
      margin: 1rem 0;
    }
    .media-item {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
    }
    .media-item img { width: 100%; display: block; }
    .media-caption {
      padding: 0.75rem;
      font-size: 0.85rem;
      color: var(--text-muted);
    }
    .phase-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1.25rem;
      margin: 1rem 0;
    }
    .phase-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    ul { margin-left: 1.25rem; margin-bottom: 0.75rem; }
    li { margin: 0.25rem 0; }
    code {
      background: var(--surface-2);
      padding: 1px 4px;
      border-radius: 3px;
      font-size: 0.85em;
      font-family: 'JetBrains Mono', monospace;
    }
    .features-list li { margin: 0.5rem 0; }
  </style>
</head>
<body>

  <div class="header">
    <h1>S26-NUR Sprint Review</h1>
    <div class="subtitle">Nursery Inspector Rationalization + SFR Bridge</div>
    <div class="subtitle" style="margin-top: 0.25rem; font-size: 0.85rem;">Protocol: Grove Execution Protocol v1.5 | Date: 2026-01-27</div>
  </div>

  <!-- 1. SUMMARY METRICS -->
  <h2>Summary Metrics</h2>
  <div class="metrics">
    <div class="metric success">
      <div class="value">4/4</div>
      <div class="label">Phases Complete</div>
    </div>
    <div class="metric accent">
      <div class="value">0</div>
      <div class="label">TypeScript Errors</div>
    </div>
    <div class="metric violet">
      <div class="value">2</div>
      <div class="label">Screenshots Captured</div>
    </div>
    <div class="metric success">
      <div class="value">Complete</div>
      <div class="label">Sprint Status</div>
    </div>
  </div>

  <!-- 2. USER STORIES TABLE -->
  <h2>User Stories</h2>
  <table>
    <thead>
      <tr><th>Story ID</th><th>Title</th><th>Priority</th><th>Status</th></tr>
    </thead>
    <tbody>
      <tr>
        <td>US-N001</td>
        <td>View Artifacts button in SproutEditor inspector</td>
        <td><span class="badge badge-success">P0</span></td>
        <td><span class="badge badge-success">Done</span></td>
      </tr>
      <tr>
        <td>US-N002</td>
        <td>Promote opens SFR modal (Modal Interception Pattern)</td>
        <td><span class="badge badge-success">P0</span></td>
        <td><span class="badge badge-success">Done</span></td>
      </tr>
      <tr>
        <td>US-N003</td>
        <td>Garden-bridge promotion from Nursery context</td>
        <td><span class="badge badge-success">P0</span></td>
        <td><span class="badge badge-success">Done</span></td>
      </tr>
      <tr>
        <td>US-N004</td>
        <td>Post-promotion status display in inspector</td>
        <td><span class="badge badge-success">P0</span></td>
        <td><span class="badge badge-success">Done</span></td>
      </tr>
      <tr>
        <td>US-N005</td>
        <td>Promoted navigation tab + StatusBadge</td>
        <td><span class="badge badge-accent">P1</span></td>
        <td><span class="badge badge-success">Done</span></td>
      </tr>
      <tr>
        <td>US-N006</td>
        <td>nurseryToSprout adapter (core/adapters)</td>
        <td><span class="badge badge-success">P0</span></td>
        <td><span class="badge badge-success">Done</span></td>
      </tr>
    </tbody>
  </table>

  <!-- 3. PHASE PROGRESS -->
  <h2>Phase Progress</h2>

  <div class="phase-card">
    <div class="phase-header">
      <h3>Phase 1a: nurseryToSprout Adapter</h3>
      <span class="badge badge-success">Complete</span>
    </div>
    <ul>
      <li>Created <code>src/core/adapters/nurseryToSprout.ts</code> (163 lines)</li>
      <li><code>NurseryBridgeInput</code> interface avoids core&rarr;bedrock import violation</li>
      <li><code>mapStatus()</code> maps ResearchSproutStatus &rarr; SproutStatus (3-value)</li>
      <li><code>mapStage()</code> maps ResearchSproutStatus &rarr; SproutStage (8-value botanical)</li>
      <li>Added <code>generatedArtifacts</code>, <code>promotedAt</code>, <code>promotionTier</code>, <code>promotionGardenDocId</code> to SproutPayload</li>
      <li>Added <code>'promoted'</code> to ResearchSproutStatus union + VALID_STATUSES + transition map</li>
    </ul>
  </div>

  <div class="phase-card">
    <div class="phase-header">
      <h3>Phase 1b: View Artifacts Button + SFR Modal Launch</h3>
      <span class="badge badge-success">Complete</span>
    </div>
    <ul>
      <li>"View Artifacts" button with violet accent + artifact count badge</li>
      <li>Badge shows <code>generatedArtifacts.length</code> with <code>aria-label</code> for accessibility</li>
      <li>Added <code>aria-haspopup="dialog"</code> on Promote and View Artifacts buttons</li>
      <li>Imported and rendered SproutFinishingRoom modal</li>
      <li>Wired <code>nurseryToSprout</code> adapter via <code>useMemo</code> for efficient conversion</li>
      <li>Added post-promotion status display (green banner with timestamp + tier)</li>
    </ul>
  </div>

  <div class="phase-card">
    <div class="phase-header">
      <h3>Phase 3a: Wire garden-bridge Promotion Pipeline</h3>
      <span class="badge badge-success">Complete</span>
    </div>
    <ul>
      <li>Enhanced SFR <code>handlePromoteToGarden</code> with <code>getSprout(sprout.id) ?? sprout</code> fallback</li>
      <li>Enriched <code>onSproutUpdate</code> with <code>promotionGardenDocId</code>, <code>promotionTier</code>, <code>promotedAt</code></li>
      <li><code>handleSFRSproutUpdate</code> extracts promotion data via type assertion</li>
      <li>Patch operations: status='promoted', promotedAt, promotionGardenDocId, promotionTier</li>
      <li>Post-promotion display shows truncated Garden doc ID for traceability</li>
    </ul>
  </div>

  <div class="phase-card">
    <div class="phase-header">
      <h3>Phase 3b: Promoted Navigation Tab</h3>
      <span class="badge badge-success">Complete</span>
    </div>
    <ul>
      <li>Added <code>promoted</code> to <code>NURSERY_STATUS_CONFIG</code> (label: 'Promoted', icon: 'park', color: 'cyan')</li>
      <li>Added <code>promoted</code> navigation tab with filter <code>{ 'payload.status': 'promoted' }</code></li>
      <li>Added <code>'promoted'</code> to filter options array</li>
      <li>Updated <code>StatusBadge.getDisplayStatus()</code> for promoted mapping</li>
      <li>Typed <code>colorStyles</code> as <code>Record&lt;NurseryDisplayStatus, CSSProperties&gt;</code></li>
    </ul>
  </div>

  <!-- 4. SCREENSHOTS -->
  <h2>Screenshots</h2>
  <div class="screenshot-grid">
    <div class="media-item">
      <img src="screenshots/3b-nursery-console.png" alt="Nursery Console with promoted navigation tab">
      <div class="media-caption">Phase 3b: Nursery Console showing promoted navigation tab in sidebar</div>
    </div>
    <div class="media-item">
      <img src="screenshots/1b-explore-context.png" alt="Explore page context">
      <div class="media-caption">Phase 1b: Explore page context (SFR modal launches from both contexts)</div>
    </div>
  </div>

  <!-- 5. FILES CHANGED -->
  <h2>Files Changed</h2>
  <table>
    <thead>
      <tr><th>File</th><th>Type</th><th>Changes</th></tr>
    </thead>
    <tbody>
      <tr>
        <td class="file-new"><code>src/core/adapters/nurseryToSprout.ts</code></td>
        <td><span class="badge badge-success">NEW</span></td>
        <td>163 lines &mdash; Adapter mapping NurseryBridgeInput &rarr; Sprout</td>
      </tr>
      <tr>
        <td class="file-mod"><code>src/core/schema/research-sprout.ts</code></td>
        <td><span class="badge badge-warning">MOD</span></td>
        <td>3 edits &mdash; Added 'promoted' status + transitions</td>
      </tr>
      <tr>
        <td class="file-mod"><code>src/bedrock/consoles/NurseryConsole/useNurseryData.ts</code></td>
        <td><span class="badge badge-warning">MOD</span></td>
        <td>3 edits &mdash; New SproutPayload fields + DB column mappings</td>
      </tr>
      <tr>
        <td class="file-mod"><code>src/bedrock/consoles/NurseryConsole/SproutEditor.tsx</code></td>
        <td><span class="badge badge-warning">MOD</span></td>
        <td>~137 lines added &mdash; View Artifacts, SFR modal, promotion handler, StatusBadge</td>
      </tr>
      <tr>
        <td class="file-mod"><code>src/bedrock/consoles/NurseryConsole/NurseryConsole.config.ts</code></td>
        <td><span class="badge badge-warning">MOD</span></td>
        <td>4 edits &mdash; Promoted status config, navigation tab, filter options</td>
      </tr>
      <tr>
        <td class="file-mod"><code>src/surface/.../SproutFinishingRoom.tsx</code></td>
        <td><span class="badge badge-warning">MOD</span></td>
        <td>1 edit &mdash; Fallback for Nursery sprouts + promotion data enrichment</td>
      </tr>
    </tbody>
  </table>

  <!-- 6. KEY FEATURES DELIVERED -->
  <h2>Key Features Delivered</h2>
  <ul class="features-list">
    <li><strong>Modal Interception Pattern:</strong> "Promote" button in Nursery inspector now opens the SproutFinishingRoom modal instead of directly archiving. Users can review artifacts, generate documents, and promote to Garden through the full SFR workflow.</li>
    <li><strong>View Artifacts Button:</strong> New violet-accented button with artifact count badge in the inspector panel. Shows generated artifact count with accessibility labels.</li>
    <li><strong>Cross-Context Promotion Pipeline:</strong> garden-bridge two-step promotion (upload + provenance patch) works from both Explore and Nursery contexts. Falls back to sprout prop when localStorage is unavailable (Supabase-backed Nursery sprouts).</li>
    <li><strong>Promotion Data Flow:</strong> Full provenance chain: gardenDocId, promotionTier, promotedAt all persist to Supabase via PatchOperation pipeline and display in the inspector.</li>
    <li><strong>Promoted Navigation Tab:</strong> Sidebar navigation includes "Promoted" filter tab. StatusBadge, filter options, and status config all handle the new promoted status.</li>
    <li><strong>nurseryToSprout Adapter:</strong> Clean adapter in <code>src/core/adapters/</code> bridges GroveObject&lt;SproutPayload&gt; to Sprout type without import violations. Pure mapping, no domain logic.</li>
  </ul>

  <!-- 7. DEX COMPLIANCE -->
  <h2>DEX Compliance</h2>
  <table>
    <thead>
      <tr><th>Pillar</th><th>Status</th><th>Evidence</th></tr>
    </thead>
    <tbody>
      <tr>
        <td>Declarative Sovereignty</td>
        <td><span class="badge badge-success">PASS</span></td>
        <td>Adapter is pure mapping. Status config and navigation are declarative data. Badge visibility driven by data.</td>
      </tr>
      <tr>
        <td>Capability Agnosticism</td>
        <td><span class="badge badge-success">PASS</span></td>
        <td>No model dependencies. Modal is model-agnostic. garden-bridge is model-agnostic.</td>
      </tr>
      <tr>
        <td>Provenance as Infrastructure</td>
        <td><span class="badge badge-success">PASS</span></td>
        <td>gardenDocId, tier, promotedAt tracked. Full provenance chain from Nursery through SFR to Garden.</td>
      </tr>
      <tr>
        <td>Organic Scalability</td>
        <td><span class="badge badge-success">PASS</span></td>
        <td>New fields additive. Adapter extends naturally. Status, navigation, filter all declarative.</td>
      </tr>
    </tbody>
  </table>

  <h2>Build Verification</h2>
  <div class="phase-card">
    <p><strong>Build:</strong> <span class="badge badge-success">PASS</span> &mdash; <code>vite build</code> completed in 9.85s, zero TypeScript errors</p>
    <p style="margin-top:0.5rem"><strong>Strangler Fig:</strong> <span class="badge badge-success">PASS</span> &mdash; Zero frozen zone files modified</p>
    <p style="margin-top:0.5rem"><strong>Files:</strong> 1 new + 5 modified, 171 insertions, 22 deletions</p>
  </div>

</body>
</html>
